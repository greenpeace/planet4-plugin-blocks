function Select2FieldsSetup(){"undefined"!==sui.views&&(sui.views.editAttributeSelect2Field.prototype.preselect=function(e){var t=String(this.getValue());if(t.length){var o={include:t,shortcode:this.shortcode.get("shortcode_tag"),attr:this.model.get("attr")};return"shortcake_newcovers"===this.shortcode.get("shortcode_tag")&&"posts"===this.model.get("attr")&&(this.ajaxData.action="planet4_blocks_post_field"),$.get(ajaxurl,$.extend(o,this.ajaxData),function(t){_.each(t.data.items,function(t){$("<option>").attr("value",t.id).text(t.text).prop("selected","selected").appendTo(e)})})}return null},sui.views.editAttributeSelect2Field.prototype.render=function(){var e=this,t={multiple:!1};for(var o in t)this.model.get(o)||this.model.set(o,t[o]);var s=this.model.toJSON();s.id="shortcode-ui-"+this.model.get("attr")+"-"+this.model.cid,this.$el.html(this.template(s));var i=this.$el.find(this.selector);void 0===this.shortcode.get("ajax_requests")&&this.shortcode.set("ajax_requests",[]);var a=this.preselect(i);if(null!==a){var c=this.shortcode.get("ajax_requests");Array.isArray(c)&&(c.push(a),this.shortcode.set("ajax_requests",c))}var l=this.model.get("meta").select2_options,d={multiple:this.model.get("multiple"),dropdownParent:this.$el,allowClear:!0,ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(t){return"shortcake_newcovers"===e.shortcode.get("shortcode_tag")&&"posts"===e.model.get("attr")?(e.ajaxData.action="planet4_blocks_post_field",$.extend({type:function(){return $("input[name=cover_type]:checked").val()},s:t.term,page:t.page,shortcode:e.shortcode.get("shortcode_tag"),attr:e.model.get("attr"),action:"wp_ajax_planet4_blocks_post_field"},e.ajaxData)):$.extend({s:t.term,page:t.page,shortcode:e.shortcode.get("shortcode_tag"),attr:e.model.get("attr")},e.ajaxData)},processResults:function(e,t){var o=e.data;return t.page=t.page||1,e.success&&void 0!==e.data?{results:o.items,pagination:{more:t.page*o.items_per_page<o.found_items}}:{results:[]}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:0,templateResult:this.templateResult,templateSelection:this.templateSelection},r=Object.assign({},d,l),n=this;return _.defer(function(){i[shortcodeUIData.select2_handle](r);n.model.get("multiple")&&n.sortable(i)},n,i),this})}function P4FieldsSetup(){if(void 0!==wp.shortcake){shortcodeUIFieldData.p4_select={encode:!1,template:"shortcode-ui-field-p4-select",view:"editAttributeHeading"},shortcodeUIFieldData.p4_checkbox={encode:!1,template:"shortcode-ui-field-p4-checkbox",view:"editAttributeHeading"},shortcodeUIFieldData.p4_radio={encode:!1,template:"shortcode-ui-field-p4-radio",view:"editAttributeHeading"};var e=function(){$(".shortcode-ui-attribute-heading2").parent().before("<p></p>"),$(".shortcode-ui-attribute-heading3").parent().before("<p></p>")};wp.shortcake.hooks.addAction("shortcode-ui.render_edit",e),wp.shortcake.hooks.addAction("shortcode-ui.render_new",e)}}function WPShortcakeHooksSetup(e){var t=this;void 0!==wp.shortcake&&(t.attach_hooks=function(){e.hooks_defined||(e.hooks_defined=!0,wp.shortcake.hooks.addAction("shortcake_newcovers.cover_type",e.blocks.NewCoversBlock.type_of_cover_change_hook),wp.shortcake.hooks.addAction("shortcake_newcovers.tags",e.blocks.NewCoversBlock.tags_change_hook),wp.shortcake.hooks.addAction("shortcake_newcovers.post_types",e.blocks.NewCoversBlock.post_types_change_hook),wp.shortcake.hooks.addAction("shortcake_newcovers.posts",e.blocks.NewCoversBlock.posts_select_change_hook),wp.shortcake.hooks.addAction("shortcake_articles.posts",e.blocks.ArticlesBlock.posts_select_change_hook),wp.shortcake.hooks.addAction("shortcake_articles.post_types",e.blocks.ArticlesBlock.page_types_change_hook),wp.shortcake.hooks.addAction("shortcake_articles.tags",e.blocks.ArticlesBlock.page_types_change_hook),wp.shortcake.hooks.addAction("shortcake_articles.read_more_link",e.blocks.ArticlesBlock.read_more_change_hook),wp.shortcake.hooks.addAction("shortcake_social_media.embed_type",e.blocks.SocialMediaBlock.embed_type_change_hook)),e.blocks.SocialMediaBlock.initialize_fields()},wp.shortcake.hooks.addAction("shortcode-ui.render_new",function(o){t.attach_hooks();var s=o.get("shortcode_tag");"shortcake_columns"===s&&e.blocks.ColumnsBlock.render_new(o),"shortcake_carousel_header"===s&&e.blocks.CarouselHeaderBlock.render_new()}),wp.shortcake.hooks.addAction("shortcode-ui.render_edit",function(o){t.attach_hooks();var s=o.get("shortcode_tag"),i=s.replace("shortcake_","");if(["shortcake_articles","shortcake_newcovers"].includes(s)){var a=o.get("ajax_requests");if(null!==a){var c=$(".shortcode-ui-edit-"+s);c.addClass("not-clickable"),c.prev().prepend('<span class="spinner is-active" id="bl_loader"></span><span id="bl_loading_span">Populating block\'s fields..</span>'),c.animate({opacity:.5}),Promise.all(a).then(function(){c.animate({opacity:1}),c.removeClass("not-clickable"),$("#bl_loader").removeClass("is-active"),$("#bl_loading_span").remove(),o.unset("ajax_requests"),e.initialize_view_fields(i)})}}"shortcake_columns"===s&&e.blocks.ColumnsBlock.render_edit(o),"shortcake_carousel_header"===s&&e.blocks.CarouselHeaderBlock.render_edit()}))}function ArticlesBlock(e){this.page_types_change_hook=function(){var e=$("select[id^='shortcode-ui-post_types']").val(),t=$("select[id^='shortcode-ui-tags']").val();null===e&&null===t?$("select[id^='shortcode-ui-posts']").prop("disabled",!1):($("select[id^='shortcode-ui-posts']").val(null).trigger("change.select2"),$("select[id^='shortcode-ui-posts']").prop("disabled","disabled"))},this.posts_select_change_hook=function(){null===$("select[id^='shortcode-ui-posts']").val()?($("select[id^='shortcode-ui-tags']").prop("disabled",!1),$("select[id^='shortcode-ui-post_types']").prop("disabled",!1),$("input[name^='ignore_categories']").prop("disabled",!1)):($("select[id^='shortcode-ui-post_types']").val(null).trigger("change.select2"),$("select[id^='shortcode-ui-post_types']").prop("disabled","disabled"),$("select[id^='shortcode-ui-tags']").val(null).trigger("change.select2"),$("select[id^='shortcode-ui-tags']").prop("disabled","disabled"),$("input[name^='ignore_categories']").prop("disabled","disabled"))},this.read_more_change_hook=function(t,o){var s=e.find_view(o,"read_more_link");if("undefined"!==s&&void 0!==t.value){var i="";"undefined"!==(i=/%[0-9a-f]/i.test(t.value)?t.value:encodeURI(t.value))&&(s.model.set("value",i),$("*[id^='shortcode-ui-read_more_link-']").val(i))}},this.initialize_view_fields=function(){var e=$("select[id^='shortcode-ui-posts']").val(),t=$("select[id^='shortcode-ui-tags']").val(),o=$("select[id^='shortcode-ui-post_types']").val();null!==e?($("select[id^='shortcode-ui-post_types']").prop("disabled","disabled"),$("select[id^='shortcode-ui-tags']").prop("disabled","disabled")):null===t&&null===o||$("select[id^='shortcode-ui-posts']").prop("disabled","disabled")}}function CarouselHeaderBlock(e){var t=this;t.render_new=function(){t.setDefaults()},t.render_edit=function(){t.toggle_subheaders(),t.set_maxlength(),$("input[name=block_style]").off("click").on("click",function(){t.toggle_subheaders(),t.set_maxlength()})},t.setDefaults=function(){$("input[name=carousel_autoplay]").attr("checked","checked")},t.toggle_subheaders=function(){var e=$("input[name=block_style]:checked").val();$("input[data-subheader=true]").closest(".field-block").toggle("full-width-classic"!=e)},t.add_maxlength_with_counter=function(e,t){($(e).attr("maxlength",t),$(e).next("div").length)||$('<div class="max-length-counter">0/'+t+"</div>").insertAfter(e);$(e).off("input").on("input",function(){var o=$(e).val().length;$(e).next("div.max-length-counter").html(o+"/"+t)})},t.set_maxlength=function(){var e=this;"full-width-classic"==$("input[name=block_style]:checked").val()?($("input[name^='header_']").each(function(){e.add_maxlength_with_counter(this,32)}),$("textarea[name^='description_']").each(function(){e.add_maxlength_with_counter(this,200)}),$("input[name^='link_text_']").each(function(){e.add_maxlength_with_counter(this,24)})):($("input[name^='header_']").attr("maxlength",40),$("textarea[name^='description_']").removeAttr("maxlength"),$("input[name^='link_text_']").removeAttr("maxlength"),$("div.maxLengthCounter").remove())}}function ColumnsBlock(e){var t=this;t.render_new=function(){$(".shortcode-ui-edit-shortcake_columns").append('<div data-row="0"><button class="button button-small shortcake-columns-add-column">Add Column</button><button class="button button-small shortcake-columns-remove-column" disabled="disabled">Remove Column</button></div>'),this.hide_all_columns(),this.add_click_event_handlers()},t.render_edit=function(){$(".shortcode-ui-edit-shortcake_columns").append('<div data-row="0"><button class="button button-small shortcake-columns-add-column" data-row="1 data-action="add">Add Column</button><button class="button button-small shortcake-columns-remove-column">Remove Column</button></div>');var e=0;[1,2,3,4].forEach(function(t){""!==$(".field-block").filter($("div[class$='_"+t+"']")).children().filter($("input, textarea")).map(function(e,t){return $(t).val()}).get().join("")&&(e=t)}),$(".shortcake-columns-add-column").parent().data("row",e);for(var t=e+1;t<=4;t++)$(".field-block").filter($("div[class$='_"+t+"']")).hide();4===e&&$(".shortcake-columns-add-column").attr("disabled","disabled"),this.toggle_images(),this.add_click_event_handlers()},t.add_click_event_handlers=function(){var e=this;$(".shortcake-columns-add-column").on("click",function(t){t.preventDefault();var o=$(t.currentTarget),s=o.parent().data("row");s<5&&(e.show_column(++s),o.parent().data("row",s),$(".shortcake-columns-remove-column").removeAttr("disabled"),4===s&&o.attr("disabled","disabled"))}),$(".shortcake-columns-remove-column").on("click",function(t){t.preventDefault();var o=$(t.currentTarget),s=o.parent().data("row");s>=0&&(e.hide_column(s--),o.parent().data("row",s),$(".shortcake-columns-add-column").removeAttr("disabled"),0===s&&o.attr("disabled","disabled"))}),$("input[name=columns_block_style]").off("click").on("click",function(){t.toggle_images()})},t.hide_column=function(e){var t=$(".field-block").filter($("div[class$='_"+e+"']"));t.children().filter($("input, textarea")).each(function(e,t){$(t).val("").trigger("input")}),t.find($(".attachment-previews .remove")).each(function(e,t){$(t).click()}),t.hide(300)},t.hide_all_columns=function(){[1,2,3,4].forEach(function(e){$(".field-block").filter($("div[class$='_"+e+"']")).hide()})},t.show_column=function(e){$(".field-block").filter($("div[class$='_"+e+"']")).show(300,function(){t.toggle_images(),$(".media-frame-content").animate({scrollTop:$(".shortcode-ui-content").prop("scrollHeight")},300)})},t.toggle_images=function(){[1,2,3,4].forEach(function(e){var t=$(".field-block").filter($("div[class$='title_"+e+"']")).is(":visible"),o="no_image"!=$("input[name=columns_block_style]:checked").val();$(".shortcode-ui-attribute-attachment_"+e).toggle(t&&o)})}}function CookiesBlock(e){var t=this;t.cookie=readCookie("greenpeace"),t.setNoTrackCookie=function(){$("#necessary_cookies").is(":checked")||$("#all_cookies").is(":checked")?createCookie("no_track","true",-1):createCookie("no_track","true",7300)},"1"===t.cookie?$("#necessary_cookies").prop("checked",!0):"2"===t.cookie&&($("#necessary_cookies").prop("checked",!0),$("#all_cookies").prop("checked",!0)),$("#necessary_cookies").on("change",function(){$("#necessary_cookies").is(":checked")?(createCookie("greenpeace","1",365),$(".cookie-notice").slideUp("slow")):($("#all_cookies").prop("checked",!1),createCookie("greenpeace","0",-1),$(".cookie-notice").show()),t.setNoTrackCookie()}),$("#all_cookies").on("change",function(){$("#all_cookies").is(":checked")?($("#necessary_cookies").prop("checked",!0),createCookie("greenpeace","2",365),$(".cookie-notice").slideUp("slow")):$("#necessary_cookies").is(":checked")?createCookie("greenpeace","1",365):(createCookie("greenpeace","0",-1),$(".cookie-notice").show()),t.setNoTrackCookie()})}function NewCoversBlock(e){var t=this;t.type_of_cover_change_hook=function(){var e=$("input[name=cover_type]:checked").val();"undefined"!==e&&("1"===e?($("select[id^='shortcode-ui-post_types']").prop("disabled","disabled"),$("select[id^='shortcode-ui-posts']").prop("disabled",!1),$("select[id^='shortcode-ui-posts']").val(null).trigger("change"),$("select[id^='shortcode-ui-tags']").val(null).trigger("change")):"2"===e?($("select[id^='shortcode-ui-post_types']").prop("disabled","disabled"),$("select[id^='shortcode-ui-posts']").prop("disabled","disabled"),$("select[id^='shortcode-ui-posts']").val(null).trigger("change"),$("select[id^='shortcode-ui-tags']").val(null).trigger("change")):"3"===e&&($("select[id^='shortcode-ui-post_types']").prop("disabled",!1),$("select[id^='shortcode-ui-posts']").prop("disabled",!1),$("select[id^='shortcode-ui-posts']").val(null).trigger("change"),$("select[id^='shortcode-ui-tags']").val(null).trigger("change")))},t.initialize_view_fields=function(){var e=$("input[name=cover_type]:checked").val(),t=$("select[id^='shortcode-ui-posts']").val(),o=$("select[id^='shortcode-ui-tags']").val(),s=$("select[id^='shortcode-ui-post_types']").val();"undefined"!==e&&("1"===e?($("select[id^='shortcode-ui-post_types']").prop("disabled","disabled"),$("select[id^='shortcode-ui-post_types']").val(null).trigger("change"),null===o&&null===s||($("select[id^='shortcode-ui-posts']").prop("disabled","disabled"),$("select[id^='shortcode-ui-posts']").val(null).trigger("change")),null!==t&&($("select[id^='shortcode-ui-tags']").prop("disabled","disabled"),$("select[id^='shortcode-ui-tags']").val(null).trigger("change"))):"2"===e?($("select[id^='shortcode-ui-post_types']").prop("disabled","disabled"),$("select[id^='shortcode-ui-post_types']").val(null).trigger("change"),$("select[id^='shortcode-ui-posts']").prop("disabled","disabled"),$("select[id^='shortcode-ui-posts']").val(null).trigger("change")):"3"===e&&(null===o&&null===s||($("select[id^='shortcode-ui-posts']").prop("disabled","disabled"),$("select[id^='shortcode-ui-posts']").val(null).trigger("change")),null!==t&&($("select[id^='shortcode-ui-tags']").prop("disabled","disabled"),$("select[id^='shortcode-ui-tags']").val(null).trigger("change"),$("select[id^='shortcode-ui-post_types']").prop("disabled","disabled"),$("select[id^='shortcode-ui-post_types']").val(null).trigger("change"))))},t.post_types_change_hook=function(){var e=$("input[name=cover_type]:checked").val(),t=$("select[id^='shortcode-ui-tags']").val(),o=$("select[id^='shortcode-ui-post_types']").val(),s=$("select[id^='shortcode-ui-posts']").val();"undefined"!==e&&"3"===e&&(null!==o?($("select[id^='shortcode-ui-tags']").prop("disabled",!1),$("select[id^='shortcode-ui-post_types']").prop("disabled",!1),$("select[id^='shortcode-ui-posts']").val(null).trigger("change"),$("select[id^='shortcode-ui-posts']").prop("disabled","disabled")):null===t&&null===s&&null===o&&($("select[id^='shortcode-ui-tags']").prop("disabled",!1),$("select[id^='shortcode-ui-post_types']").prop("disabled",!1),$("select[id^='shortcode-ui-posts']").prop("disabled",!1)))},t.posts_select_change_hook=function(){var e=$("input[name=cover_type]:checked").val(),t=$("select[id^='shortcode-ui-posts']").val();"undefined"!==e&&(null!==t?"1"===e?($("select[id^='shortcode-ui-tags']").val(null).trigger("change"),$("select[id^='shortcode-ui-tags']").prop("disabled","disabled")):"3"===e&&($("select[id^='shortcode-ui-tags']").val(null).trigger("change"),$("select[id^='shortcode-ui-tags']").prop("disabled","disabled"),$("select[id^='shortcode-ui-post_types']").val(null).trigger("change"),$("select[id^='shortcode-ui-post_types']").prop("disabled","disabled")):"1"===e?$("select[id^='shortcode-ui-tags']").prop("disabled",!1):"3"===e&&($("select[id^='shortcode-ui-tags']").prop("disabled",!1),$("select[id^='shortcode-ui-post_types']").prop("disabled",!1)))},t.tags_change_hook=function(){var e=$("input[name=cover_type]:checked").val(),t=$("select[id^='shortcode-ui-posts']").val(),o=$("select[id^='shortcode-ui-tags']").val(),s=$("select[id^='shortcode-ui-post_types']").val();"undefined"!==e&&("1"===e?null!==o||null!==s?($("select[id^='shortcode-ui-posts']").prop("disabled","disabled"),$("select[id^='shortcode-ui-posts']").val(null).trigger("change"),$("select[id^='shortcode-ui-post_types']").prop("disabled","disabled")):null===o&&null===t&&($("select[id^='shortcode-ui-tags']").prop("disabled",!1),$("select[id^='shortcode-ui-posts']").prop("disabled",!1)):"2"===e?($("select[id^='shortcode-ui-posts']").prop("disabled","disabled"),$("select[id^='shortcode-ui-posts']").val(null).trigger("change"),$("select[id^='shortcode-ui-tags']").prop("disabled",!1),$("select[id^='shortcode-ui-post_types']").val(null).trigger("change"),$("select[id^='shortcode-ui-post_types']").prop("disabled","disabled")):"3"===e&&(null!==o?($("select[id^='shortcode-ui-tags']").prop("disabled",!1),$("select[id^='shortcode-ui-post_types']").prop("disabled",!1),$("select[id^='shortcode-ui-posts']").val(null).trigger("change"),$("select[id^='shortcode-ui-posts']").prop("disabled","disabled")):null===o&&null===t&&null===s&&$("select[id^='shortcode-ui-posts']").prop("disabled",!1)))}}function SocialMediaBlock(e){var t=this;t.initialize_fields=function(){t.set_default_embed_type(),t.toggle_facebook_page_options()},t.embed_type_change_hook=function(){t.toggle_facebook_page_options()},t.set_default_embed_type=function(){$("input[name=embed_type]:checked").val()||$("input[name=embed_type][value=oembed]").prop("checked",!0)},t.toggle_facebook_page_options=function(){var e=$(".shortcode-ui-attribute-facebook_page_tab");"facebook_page"===$("input[name=embed_type]:checked").val()?e.show():e.hide()}}function SubmenuBlock(e){this.editAttributeHeading=sui.views.editAttributeField.extend({tagName:"span",className:"block-attribute-wrapper",events:{"input  input":"inputChanged","input  textarea":"inputChanged","change select":"inputChanged",'change input[type="radio"]':"inputChanged",'change input[type="checkbox"]':"inputChanged"},inputChanged:function(e){var t;if(this.model.get("attr")&&(t=this.$el.find('[name="'+this.model.get("attr")+'"]')),"radio"===this.model.attributes.type||"p4_radio"===this.model.attributes.type)this.setValue(t.filter(":checked").first().val());else if("checkbox"===this.model.attributes.type||"p4_checkbox"===this.model.attributes.type)this.setValue(t.is(":checked"));else if("range"===this.model.attributes.type){var o="#"+e.target.id+"_indicator",s=e.target.value;document.querySelector(o).value=s,this.setValue(t.val())}else this.setValue(t.val());this.triggerCallbacks()},setValue:function(e){this.model.set("value",e)},triggerCallbacks:function(){var e=[this.shortcode.attributes.shortcode_tag,this.model.get("attr")].join("."),t=this.model.changed,o=_.flatten(_.values(this.views.parent.views._views)),s=this.shortcode;wp.shortcake.hooks.doAction(e,t,o,s)}}),sui.views.editAttributeHeading=this.editAttributeHeading}function P4BlocksAdminUI(e,t,o,s){var i=this;i.hooks_defined=!1,i.setupSelect2Fields=e,i.setupP4Fields=t,i.setupWPShortcakeHooks=o,i.blocksMap=s,i.blocks={},i.initialize_view_fields=function(e){switch(e){case"articles":i.blocks.ArticlesBlock.initialize_view_fields();break;case"newcovers":i.blocks.NewCoversBlock.initialize_view_fields()}},i.find_view=function(e,t){return _.find(e,function(e){return t===e.model.get("attr")})},i.setupBlock=function(e){i.blocks[e]=new i.blocksMap[e](i)},i.setup=function(){for(var e in i.setupSelect2Fields(),i.setupP4Fields(),i.setupWPShortcakeHooks(i),i.blocksMap)i.setupBlock(e)}}jQuery(function(){"use strict";new P4BlocksAdminUI(Select2FieldsSetup,P4FieldsSetup,WPShortcakeHooksSetup,{ArticlesBlock:ArticlesBlock,CarouselHeaderBlock:CarouselHeaderBlock,ColumnsBlock:ColumnsBlock,NewCoversBlock:NewCoversBlock,SocialMediaBlock:SocialMediaBlock,SubmenuBlock:SubmenuBlock}).setup()});
//# sourceMappingURL=admin/blocks-admin.min.js.map
